# fb2_srv

NIH-проект

Сиё есть сервер opds для кучи fb2 в нескольких zip. Предназначено для запуска на одноплатниках.

Порядок работы при первоначальном запуске:

  1. либо делаем симлинк data на каталог с .zip, либо правим в app/config.py пути
  2. запускаем `./managedb.py newdb` для создания пустой БД
  3. запускаем `./managedb.py refillall` для заполнения БД данными из .zip (параллельно будут созданы файлики `*.zip.list`)
  4. для локального применения запускаем `./opds.py`, после чего на порту 5000 ловим /opds

Порядок работы при обновлении .zip:

  1. останавливаем `opds.py`
  2. запускаем `./managedb.py fillnew`
  3. запускаем `./opds.py`

Параметры `managedb.py`:

  * dropdb -- база вам надоела
  * cleandb -- надоело только содержимое базы, а вот структура - ещё нужна (будет сделано на случай хранения в БД чего-то ещё)
  * newdb -- надо свежую базу
  * fillnew -- загрузить обновлённые данные (.zip без соответствующего .zip.list, либо .zip новее, чем .zip.list). Старые записи будут удалены перед тем, как.
  * refillall -- плюнуть на всё, загрузить данные из всех .zip с нуля (без очистки содержимого).
  * fill_lists -- загрузить данные из готовых .zip.list (на случай битой базы, либо базы, на которую сказали newdb)

